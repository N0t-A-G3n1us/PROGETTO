<!DOCTYPE html>
<html>
	<head>
		<meta charset="ISO-8859-1"/>
		<script>
			function inizializzaStorageUtenti(){
				if(typeof(localStorage.utenti) == "undefined"){
					localStorage.utenti = "[]";
				}
			}
			function resetStorageUtenti(){
				localStorage.utenti = "[]";
			}
			function stampaStorageSemplice(){
				var u = JSON.parse(localStorage.utenti);
				var l = u.length;
				var s = new String("<h3>Stato di localStorage: </h3>");
				for(i = 0; i < l; i++){
					s += JSON.stringify(u[i])+"<br/>";
				}
				document.getElementById("vistaStorage").innerHTML = s;
				return true;
			}
			function stampaStorageTabella(){
				var u = JSON.parse(localStorage.utenti);
				var l = u.length;
				var s = new String("<h3>Stato di localStorage: </h3>");
				s += "<table border=1><tr><th>cognome</th><th>nome</th><th>matricola</th></tr>";
				for(i = 0; i < l; i++){
					s += "<tr><td>"+u[i].c+"</td><td>"+u[i].n+"</td><td>"+u[i].m+"</td></tr>";
				}
				s += "</table>";
				document.getElementById("vistaStorage").innerHTML = s;
				return true;
			}
			function uguali(u, o){
				if((u.c == o.c) && (u.n == o.n) && (u.m == o.m)){
					return true;
				}
				return false;
			}
			function ordina(u){
				//var u = JSON.parse(localStorage.utenti);
				var l = u.length;
				for(i = 0; i < l-1; i++){
					for(j = l-1; j > i; j--){
						if(u[j-1].m < u[j].m){
							aux = u[j-1];
							u[j-1] = u[j];
							u[j] = aux;
						}
					}
				}
			}
			function inserisciUtente(){
				if(document.registrazione.cognome.value == ""){
					alert("Inserire Cognome");
					return false;
				}
				if(document.registrazione.nome.value == ""){
					alert("Inserire Nome");
					return false;
				}
				if(document.registrazione.matricola.value == ""){
					alert("Inserire Matricola");
					return false;
				}
				var u = JSON.parse(localStorage.utenti);
				var nextpos = u.length;
				var o ={
					c: document.registrazione.cognome.value,
					n: document.registrazione.nome.value,
					m: document.registrazione.matricola.value
				};
				for(i = 0; i < nextpos; i++){
					if(uguali(u[i], o)){
						alert("Utente gia inserito");
						return false;
					}
				}
				alert("Dati inseriti correttamente");
				u[nextpos] = o;
				ordina(u);
				localStorage.utenti = JSON.stringify(u);
				return true;
			}
		</script>
	</head>
	<body onload="inizializzaStorageUtenti()">
		<form action="" method="post" name="registrazione" onSubmit="return inserisciUtente();" accept-charset="utf-8">
			<table>
			<tr>
			<td align="right"> cognome:
			<td> <input type = "text" name = "cognome" size="40" maxlength="40" required>
			<tr>
			<td align="right"> nome:
			<td><input type = "text" name = "nome" size="30" maxlength="30" required>
			<tr>
			<td align="right"> matricola:
			<td><input type = "text" name = "matricola" size = "12" maxlength="12">
			<tr>
			<td align="right">
			<td><input type = "submit" value="Invia">
			<input type = "reset" value = "Reset Form">
			<tr>
			<td align="right">
			<td><input type = "button" value="Stampa Storage Semplice" onclick="stampaStorageSemplice();">
			<input type="button" value="Stampa Storage Tabella" onclick="stampaStorageTabella();">
			<tr>
			<td align = "right">
			<td><input type = "button" value="Reset Storage" onclick="resetStorageUtenti();">
		</form>
		<hr/>
		<div id = "vistaStorage"></div>
		<hr/>
	</body>
</html>